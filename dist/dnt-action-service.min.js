/*! dnt-action-service 25-10-2014 */
(function(){angular.module("dnt.action.service",["ui.router"]).factory("ActionService",["$rootScope","$state",function(a,b){var c;return c=function(){function c(b){var c,d;this.options=b,d=this,d.options.buttons=[],c=function(){return d.options.watch},a.$watchCollection(c,function(){return 0===d.options.buttons.length&&(d.options.buttons=$(d.CODE.TOOLBAR_CSS).find("button["+d.CSS.WEIGHT+"]")),d.toggleButtons()})}return c.prototype.CODE={TR_VALUE:"value",TOOLBAR_CSS:".toolbar"},c.prototype.CSS={WEIGHT:"weight",REJECT_CSS:"reject-css",REQUIRE_CSS:"require-css"},c.prototype.INFO={REJECT:"you must select {0} records to perform this action",REJECT_AT_LEAST:"you must select {0} records to perform this action at least",CHECK_STATUS:"you can't perform this action, please check the status of records which were selected"},c.prototype.toggleButtons=function(){var a,b,c,d,e,f,g;for(c=this.getSelections(),f=this.options.buttons,g=[],d=0,e=f.length;e>d;d++)a=f[d],b=this.getConditions(a),g.push(this.checkCondition(a,b,c));return g},c.prototype.gotoState=function(a){var c;return c=this.getSelections(),b.go(a,c.datas[0])},c.prototype.perform=function(a){var b,c,d,e,f,g;if(c=this.getSelections(),1===a.length){for(f=c.datas,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(a(b));return g}return a.apply(this,c.datas)},c.prototype.checkCondition=function(a,b,c){return/^\d+$/.test(b.weight)?parseInt(b.weight)===c.datas.length?this.checkStatus(a,b,c):$(a).attr("disabled","disabled"):/^\d+\+$/.test(b.weight)?c.datas.length>=parseInt(b.weight.split(/\+/)[0])?this.checkStatus(a,b,c):$(a).attr("disabled","disabled"):$(a).removeAttr("disabled")},c.prototype.checkStatus=function(a,b,c){return this.isCssPass(b,c)?$(a).removeAttr("disabled"):$(a).attr("disabled","disabled")},c.prototype.isCssPass=function(a,b){var c,d;return c=this.getCss(a.rejectCss),d=this.getCss(a.requireCss),this.isReject(c,b.trs)?!1:this.isRequire(d,b.trs)},c.prototype.isReject=function(a,b){var c,d,e,f,g;for(f=0,g=b.length;g>f;f++){d=b[f],e=this.getClass(d);for(c in a)if(null!=e[c])return!0}return!1},c.prototype.isRequire=function(a,b){var c,d,e,f,g;for(f=0,g=b.length;g>f;f++){d=b[f],e=this.getClass(d);for(c in a)if(null==e[c])return!1}return!0},c.prototype.getConditions=function(a){var b;return b={weight:$(a).attr(this.CSS.WEIGHT),rejectCss:$(a).attr(this.CSS.REJECT_CSS),requireCss:$(a).attr(this.CSS.REQUIRE_CSS)}},c.prototype.getSelections=function(){var a,b,c,d;b={datas:[],trs:[]},d=this.options.watch;for(a in d)c=d[a],c&&(b.datas.push(this.options.mapping(a)),b.trs.push($("["+this.CODE.TR_VALUE+"="+a+"]")));return b},c.prototype.getCss=function(a){var b,c,d,e,f;if(c={},null!=a&&""!==a)for(f=a.split(/\s+/),d=0,e=f.length;e>d;d++)b=f[d],c[b]=b;return c},c.prototype.getClass=function(a){return this.getCss($(a).attr("class"))},c.prototype.stringFormat=function(){var a,b,c,d,e,f;if(0===arguments.length)return null;for(c=arguments[0],a=e=0,f=arguments.length;f>e;a=++e)d=arguments[a],0!==a&&(b=new RegExp("\\{"+(a-1)+"\\}","gm"),c=c.replace(b,d));return c},c.make=function(a){return new c(a)},c}()}])}).call(this);